console.log("storyPageFun.js loaded");let timer,page=1,limit=16,query="",language="English",totalStories_available=0;const deleteStory=async n=>{try{const e=confirm("Are you sure you want to delete this story?");if(!e)return;const t=`/terrorTales/deleteStory/${n}`;await fetch(t,{method:"POST"})}catch(n){console.error("An error occurred while deleting the story:",n.message)}},CommonStoryTemplates=(n,e)=>{const{createdAt:t,comments:a,extraTags:o,categories:i}=n,r=new Date(t),s=(r.getDate(),r.getMonth(),r.getFullYear(),a.length),l=n=>`<span class="storyTag"><span class="story_hashtag"></span>${n}</span>`,d=[...o,...i].map(l).join(""),c=id_("csrf").value;let u="";return"admin"===e&&(u=`\n            <div class="story_buttons_wrap">             \n                \n                <form id="changeStoryPermisionForm" action="/terrorTales/editStory/${n.slug}" method="GET">\n                    <button type="submit">Edit Story</button>\n                </form> \n\n                <form id="deleteStoryForm" action="/terrorTales/deleteStory" method="POST">\n                    <input type="hidden" name="slug" value="${n.slug}">\n                    <input type="hidden" name="_csrf" value="${c}">\n                    <button type="submit" onclick="return confirm('Are you sure you want to delete this story?');">Delete Story</button>\n                </form>\n                <form id="changeStoryPermisionForm" action="/terrorTales/changeStoryPermision" method="POST">\n                    <input type="hidden" name="slug" value="${n.slug}">\n                    <input type="hidden" name="_csrf" value="${c}">\n                    <button type="submit" onclick="return confirm('Are you sure you want to suspend this story?');">Suspend Story</button>\n                </form>\n            </div>\n        `),"moderator"===e&&(u=`\n            <div class="story_buttons_wrap">\n\n                <form id="changeStoryPermisionForm" action="/terrorTales/editStory/${n.slug}" method="GET">\n                    <button type="submit">Edit Story</button>\n                </form>        \n\n                <form id="changeStoryPermisionForm" action="/terrorTales/changeStoryPermision" method="POST">\n                    <input type="hidden" name="slug" value="${n.slug}">\n                    <input type="hidden" name="_csrf" value="${c}">\n                    <button type="submit" onclick="return confirm('Are you sure you want to suspend this story?');">Suspend Story</button>\n                </form>\n\n            </div>\n        `),`\n\n            <div class="story_wrap">\n\n                <div class="story_inner_wrap story_innerTitle_wrap">\n                    <h2 class="storyTitle">${n.storyTitle}</h2>\n                </div>\n\n                <div class="story_inner_wrap story_innerInfo_wrap">\n\n                    <div class="story_info_wrap">\n\n                        <div class="info_wrap_first">\n                            <div class="readingTime">\n                                <img src="../../IMAGES/Icons/clock.webp" alt="pen" />\n                                ${n.readingTime} min read\n                            </div>\n                            <div class="legalName">\n                                <img src="../../IMAGES/Icons/signature.webp" alt="pen" />\n                                <span class="userName_Sign">@</span>${n.creditingName}\n                            </div>\n                        </div>\n\n                        <div class="info_wrap_second">\n\n                            <div class="upvoteCount">\n                                <img src="../../IMAGES/Icons/upArrow1.webp" alt="pen" />\n                                ${n.upvoteCount}\n                            </div> \n\n                            <div class="upvoteCount">\n                                <img src="../../IMAGES/Icons/view.webp" alt="pen" />\n                                ${n.readCount}\n                            </div> \n\n                            <div class="upvoteCount">\n                                <img src="../../IMAGES/Icons/chat.webp" alt="pen" />\n                                ${s}\n                            </div> \n                        </div>\n                        \n                    </div>\n\n                    <h3 class="storySummary">${n.storySummary}</h3>\n\n                    <div class="storyTags_wrap">\n                        ${d}\n                    </div>\n                    \n                    ${u}                    \n                    \n                    <a class="read_story_button" href="/terrorTales/horrorStory/${n.slug}">Read Story</a>\n\n                </div>\n\n        </div>\n\n    `},loadingAnimationTemplate=()=>'\n\n            <div class="loading_story_wrap loadingHTMLTemplates">\n\n                <div class="loadingAnimation loading_story_innerTitle_wrap"></div>\n\n                <div class="loading_story_innerInfo_wrap">\n\n                    <div class="loading_story_info_wrap">\n\n                        <div class="loading_info_wrap_first">\n                            <div class="loadingAnimation loading_readingTime"></div>\n                            <div class="loadingAnimation loading_legalName"></div>\n                        </div>\n\n                        <div class="loading_info_wrap_second">\n\n                            <div class="loadingAnimation loading_upvoteCount"></div> \n\n                            <div class="loadingAnimation loading_upvoteCount"></div> \n\n                            <div class="loadingAnimation loading_upvoteCount"></div> \n\n                        </div>\n                        \n                    </div>\n\n                    <h3 class="loadingAnimation loading_storySummary"></h3>\n\n                    <div class="loading_storyTags_wrap">\n                        <span class="loadingAnimation loading_storyTag"></span>\n                        <span class="loadingAnimation loading_storyTag"></span>\n                        <span class="loadingAnimation loading_storyTag"></span>\n                    </div>\n\n                </div>\n\n        </div>\n\n    ',loadLoadinHTML=()=>{for(let n=0;n<8;n++)id_("storyListWrap").innerHTML+=loadingAnimationTemplate()},removeLoadingHTML=()=>{queryAll_(".loadingHTMLTemplates").forEach(n=>{n.remove()})},wipeOutStories=()=>{id_("storyListWrap").innerHTML=""};let allowOnce=!0;const query_fetch=async()=>{loadLoadinHTML();const n=id_("search").value,e=id_("language").value;e!==language&&(page=1,wipeOutStories(),loadLoadinHTML());const t={query:n||"",language:e||language,page:page,limit:limit},a=new URLSearchParams(t),o=`/terrorTales/query?${a.toString()}`,i=await fetch_(o,"GET",null);if(200===i.status){allowOnce&&(id_("language").innerHTML='<option value="English">English</option>',i.languagesArray.forEach(n=>{"English"!==n&&(id_("language").innerHTML+=`<option value="${n}">${n}</option>`)}),allowOnce=!1),1===page&&removeLoadingHTML();const n=id_("storyListWrap");0===i.stories.length?n.innerHTML='\n                <div class="noData">No data found</div>\n            ':(console.log("data.stories.length",i.stories.length),i.stories.forEach(e=>{n.innerHTML+=CommonStoryTemplates(e,i.UserRole),totalStories_available++}),removeLoadingHTML()),i.totalStories<=totalStories_available?id_("loadMore").style.display="none":id_("loadMore").style.display="block"}else console.log("error");language=e},debounceQueryFetch=n=>{id_("storyListWrap").innerHTML="";for(let n=0;n<8;n++)id_("storyListWrap").innerHTML+=loadingAnimationTemplate();clearTimeout(timer),timer=setTimeout(()=>{page=1,totalStories_available=0,query_fetch(n.target.value)},1e3)};id_("search").addEventListener("keyup",debounceQueryFetch),queryAll_(".selectQueryData").forEach(n=>{n.addEventListener("change",n=>{page=1,totalStories_available=0,query_fetch(n.target.value)})});const loadMoreStories=async()=>{page++,query_fetch(query,language,page,limit)};id_("loadMore").addEventListener("click",loadMoreStories),query_fetch();