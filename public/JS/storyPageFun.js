console.log("storyPageFun.js loaded");let timer,page=1,limit=8,query="",language="English",totalStories_available=0;const deleteStory=async n=>{try{if(!confirm("Are you sure you want to delete this story?"))return;const a=`/terrorTales/deleteStory/${n}`;await fetch(a,{method:"POST"})}catch(n){console.error("An error occurred while deleting the story:",n.message)}},CommonStoryTemplates=(n,a)=>{const{createdAt:i,comments:o,extraTags:t,categories:s}=n,e=new Date(i),r=(e.getDate(),e.getMonth(),e.getFullYear(),o.length),l=[...t,...s].map((n=>`<span class="storyTag"><span class="story_hashtag">#</span>${n}</span>`)).join(""),d=id_("csrf").value;let g="";return"admin"===a&&(g=`\n <div class="story_buttons_wrap"> \n \n <form id="changeStoryPermisionForm" action="/terrorTales/editStory/${n.slug}" method="GET">\n <button type="submit">Edit Story</button>\n </form> \n\n <form id="deleteStoryForm" action="/terrorTales/deleteStory" method="POST">\n <input type="hidden" name="slug" value="${n.slug}">\n <input type="hidden" name="_csrf" value="${d}">\n <button type="submit" onclick="return confirm('Are you sure you want to delete this story?');">Delete Story</button>\n </form>\n <form id="changeStoryPermisionForm" action="/terrorTales/changeStoryPermision" method="POST">\n <input type="hidden" name="slug" value="${n.slug}">\n <input type="hidden" name="_csrf" value="${d}">\n <button type="submit" onclick="return confirm('Are you sure you want to suspend this story?');">Suspend Story</button>\n </form>\n </div>\n `),"moderator"===a&&(g=`\n <div class="story_buttons_wrap">\n\n <form id="changeStoryPermisionForm" action="/terrorTales/editStory/${n.slug}" method="GET">\n <button type="submit">Edit Story</button>\n </form> \n\n <form id="changeStoryPermisionForm" action="/terrorTales/changeStoryPermision" method="POST">\n <input type="hidden" name="slug" value="${n.slug}">\n <input type="hidden" name="_csrf" value="${d}">\n <button type="submit" onclick="return confirm('Are you sure you want to suspend this story?');">Suspend Story</button>\n </form>\n\n </div>\n `),`\n\n <div class="story_wrap">\n\n <div class="story_inner_wrap story_innerTitle_wrap">\n <h2 class="storyTitle">${n.storyTitle}</h2>\n </div>\n\n <div class="story_inner_wrap story_innerInfo_wrap">\n\n <div class="story_info_wrap">\n\n <div class="info_wrap_first">\n <div class="readingTime">\n <img src="../../IMAGES/Icons/clock.webp" alt="pen" />\n ${n.readingTime} min read\n </div>\n <div class="legalName">\n <img src="../../IMAGES/Icons/signature.webp" alt="pen" />\n Written By &nbsp; <span class="userName_Sign">@</span>${n.creditingName}\n </div>\n </div>\n\n <div class="info_wrap_second">\n\n <div class="upvoteCount">\n <img src="../../IMAGES/Icons/upArrow1.webp" alt="pen" />\n ${n.upvoteCount}\n </div> \n\n <div class="upvoteCount">\n <img src="../../IMAGES/Icons/view.webp" alt="pen" />\n ${n.readCount}\n </div> \n\n <div class="upvoteCount">\n <img src="../../IMAGES/Icons/chat.webp" alt="pen" />\n ${r}\n </div> \n </div>\n \n </div>\n\n <h3 class="storySummary">${n.storySummary}</h3>\n\n <div class="storyTags_wrap">\n ${l}\n </div>\n \n ${g} \n \n <a class="read_story_button" href="/terrorTales/horrorStory/${n.slug}">Read Story</a>\n\n </div>\n\n </div>\n\n `},loadingAnimationTemplate=()=>'\n\n <div class="loading_story_wrap">\n\n <div class="loadingAnimation loading_story_innerTitle_wrap"></div>\n\n <div class="loading_story_innerInfo_wrap">\n\n <div class="loading_story_info_wrap">\n\n <div class="loading_info_wrap_first">\n <div class="loadingAnimation loading_readingTime"></div>\n <div class="loadingAnimation loading_legalName"></div>\n </div>\n\n <div class="loading_info_wrap_second">\n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n </div>\n \n </div>\n\n <h3 class="loadingAnimation loading_storySummary"></h3>\n\n <div class="loading_storyTags_wrap">\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n </div>\n\n </div>\n\n </div>\n\n ',loadLoadinHTML=()=>{id_("storyListWrap").innerHTML="";for(let n=0;n<8;n++)id_("storyListWrap").innerHTML+='\n\n <div class="loading_story_wrap">\n\n <div class="loadingAnimation loading_story_innerTitle_wrap"></div>\n\n <div class="loading_story_innerInfo_wrap">\n\n <div class="loading_story_info_wrap">\n\n <div class="loading_info_wrap_first">\n <div class="loadingAnimation loading_readingTime"></div>\n <div class="loadingAnimation loading_legalName"></div>\n </div>\n\n <div class="loading_info_wrap_second">\n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n </div>\n \n </div>\n\n <h3 class="loadingAnimation loading_storySummary"></h3>\n\n <div class="loading_storyTags_wrap">\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n </div>\n\n </div>\n\n </div>\n\n '};let allowOnce=!0;const query_fetch=async()=>{loadLoadinHTML();const n=id_("search").value,a=id_("language").value,i=`/terrorTales/query?${new URLSearchParams({query:n||"",language:a||language,page:page,limit:limit}).toString()}`,o=await fetch_(i,"GET",null);if(200===o.status){allowOnce&&(id_("language").innerHTML='<option value="English">English</option>',o.languagesArray.forEach((n=>{"English"!==n&&(id_("language").innerHTML+=`<option value="${n}">${n}</option>`)})),allowOnce=!1),1===page&&(id_("storyListWrap").innerHTML="");const n=id_("storyListWrap");0===o.stories.length?n.innerHTML='\n <div class="noData">No data found</div>\n ':o.stories.forEach((a=>{n.innerHTML+=CommonStoryTemplates(a,o.UserRole),totalStories_available++})),o.totalStories<=totalStories_available?id_("loadMore").style.display="none":id_("loadMore").style.display="block"}else console.log("error")},debounceQueryFetch=n=>{id_("storyListWrap").innerHTML="";for(let n=0;n<8;n++)id_("storyListWrap").innerHTML+='\n\n <div class="loading_story_wrap">\n\n <div class="loadingAnimation loading_story_innerTitle_wrap"></div>\n\n <div class="loading_story_innerInfo_wrap">\n\n <div class="loading_story_info_wrap">\n\n <div class="loading_info_wrap_first">\n <div class="loadingAnimation loading_readingTime"></div>\n <div class="loadingAnimation loading_legalName"></div>\n </div>\n\n <div class="loading_info_wrap_second">\n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n <div class="loadingAnimation loading_upvoteCount"></div> \n\n </div>\n \n </div>\n\n <h3 class="loadingAnimation loading_storySummary"></h3>\n\n <div class="loading_storyTags_wrap">\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n <span class="loadingAnimation loading_storyTag"></span>\n </div>\n\n </div>\n\n </div>\n\n ';clearTimeout(timer),timer=setTimeout((()=>{page=1,totalStories_available=0,query_fetch(n.target.value)}),1e3)};id_("search").addEventListener("keyup",debounceQueryFetch),queryAll_(".selectQueryData").forEach((n=>{n.addEventListener("change",(n=>{page=1,totalStories_available=0,query_fetch(n.target.value)}))}));const loadMoreStories=async()=>{page++,query_fetch()};id_("loadMore").addEventListener("click",loadMoreStories),query_fetch();
