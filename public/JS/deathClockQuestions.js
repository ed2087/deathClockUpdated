console.log("deathClock_questions.js loaded");const getQuestionsJson=async()=>(await fetch_("/questionsAPI","GET")).questions,addToJson=(e,t,o)=>{const n=e.find((e=>e.id===t));n&&(n.user={userAnswer:o,points:0})},Q1_MAX_LENGTH=10,SPECIAL_CHARACTERS=["{","}","[","]","(",")","<",">","/","\\","|","~","`","!","@","#","$","%","^","&","*","+","=","?",":",";",'"',"'"],checkQ1=e=>{e.preventDefault();let t=id_("q1"),o=t.value;o.length>10&&(t.value=o.slice(0,10),o=t.value);const n=sanitizeInput(o);t.value=n,t.style.color="white"};function calculateBMIMetric(e,t){return e/Math.pow(t,2)}function calculateBMIStandard(e,t){return 703*e/Math.pow(t,2)}function convertToInches(e,t){return 12*e+t}function calculateBMI_(){const e=document.getElementById("q23_"),t=document.getElementById("q24_"),o=parseFloat(e.value),n=t.value.split("."),s=parseFloat(n[0]),i=parseFloat(n[1]||0);if(isNaN(o)||isNaN(s)||isNaN(i)||o<=0||s<=0||i<0)return"Invalid Input";let a;a=calculateBMIStandard(o,convertToInches(s,i));return a.toFixed(2)}const convertToMetric=e=>{console.log("convertToMetric()"),e.preventDefault();let t=id_("q23_"),o=id_("q24_"),n=parseFloat(t.value),s=o.value.split("."),i=parseFloat(s[0]),a=parseFloat(s[1]||0);if(isNaN(a)||n<=0||i<=0||a<0)return;let l=.0254*convertToInches(i,a),r=.453592*n;isNaN(r)&&(r=0),isNaN(l)&&(l=0),id_("metric_height").innerHTML=`${l.toFixed(2)} M`,id_("metric_weight").innerHTML=`${r.toFixed(2)} KG`};id_("q23_")&&id_("q23_").addEventListener("change",convertToMetric),id_("q24_")&&id_("q24_").addEventListener("change",convertToMetric);const sanitizeInput=e=>{let t=e.trim();for(let e=0;e<SPECIAL_CHARACTERS.length;e++){const o=SPECIAL_CHARACTERS[e];t=t.split(o).join("")}return t},q1=id_("q1");q1&&q1.addEventListener("keyup",checkQ1);const checkAll=async e=>{e.preventDefault(),console.log("checkAll()");const t=[...queryAll_("input")],o=[...queryAll_("select")];if(!t.every((e=>"email"===e.name||""!==e.value))){for(let e=0;e<t.length;e++)if(""===t[e].value){t[e].scrollIntoView();break}return}const n=o.map((e=>e.value));let s=await getQuestionsJson();addToJson(s,"q1",id_("q1").value),addToJson(s,"q2",id_("q2").value);let i=0;for(let e=0;e<o.length;e++)if(o[e]&&o[e].name)for(let t=0;t<s.length;t++)if(23!==s[t].id&&o[e].id.toLowerCase()===s[t].id.toLowerCase())for(let o=0;o<s[t].answer_options.length;o++){n[e].trim().toLowerCase()===s[t].answer_options[o].option.trim().toLowerCase()&&(i+=s[t].answer_options[o].scores[0],s[t].user={userAnswer:n[e],points:s[t].answer_options[o].scores[0]})}const a=id_("q23_").value,l=id_("q24_").value;addToJson(s,"q23",a),addToJson(s,"q24",l);const r=calculateBMI_();addToJson(s,"q25",r);const c={id:"userPermission",userPermission:id_("q_permission").value},d={_csrf:id_("csrf").value},u={totalPoints:i};s.push(u,c,d);const _=await sendJson("/questionsAPI","POST",s);if(_){const e=_.userShortId;window.location.href="/deathClock/results/"+e}else console.log("Error sending json");id_("submit_btn").disabled=!0},healthForm=id_("healthForm");healthForm&&healthForm.addEventListener("submit",checkAll);
