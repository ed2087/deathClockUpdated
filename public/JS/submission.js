async function isUrlSecured(e){try{new URL(e);const t=/^https:\/\//;return t.test(e)}catch(e){return!1}}function validateUrl(){let e=id_("website").value;setTimeout(async()=>{await isUrlSecured(e)?id_("website").style.color="green":id_("website").style.color="red"},1e3)}function validateImgurLink(){let e=id_("backgroundUrl").value;setTimeout(async()=>{await isUrlSecured(e)?id_("imgurLink").style.color="green":id_("imgurLink").style.color="red"},1e3)}function toggleTerms(e){e.preventDefault();let t=id_("termsAndConditions"),r=id_("showTermsLink");isTermsVisible=!isTermsVisible,t.style.display=isTermsVisible?"block":"none",r.textContent=isTermsVisible?"Hide Terms and Conditions":"Show Terms and Conditions",r.style.color=isTermsVisible?"":"red",isTermsVisible?t.focus():r.focus()}console.log("submission.js loaded");const sendData=async e=>{e.preventDefault();const t=document.querySelector("#submission_form"),r=t.querySelectorAll("input, textarea, select, checkbox, radio"),i={};r.forEach(e=>{i[e.name]=e.value});const s=document.querySelectorAll('input[name="socialMedia"]'),o=[];s.forEach(e=>{o.push(e.value)}),i.socialMedia=o;const l=document.querySelectorAll('input[name="categories"]:checked'),a=[];l.forEach(e=>{a.push(e.value)}),i.categories=a;const n=document.querySelectorAll('input[type="radio"]');n.forEach(e=>{e.checked&&(i[e.name]=e.value)});const d=document.querySelectorAll("select");d.forEach(e=>{i[e.name]=e.value});const c=document.querySelectorAll("textarea");c.forEach(e=>{i[e.name]=e.value});let u="/terrorTales/submission",m="POST",y=i;try{const e=await fetch(u,{method:m,body:JSON.stringify(y),headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?window.location.href="/terrorTales":alert(t.message)}catch(e){console.log(e)}},alertUserCharacters=(e,t)=>{let r=id_(e).value,i=r.length;i>t?(r=r.slice(0,t),id_(e).value=r,id_(e).style.color="red",id_("storySubmit_form").disabled=!0):(id_(e).style.color="black",id_("storySubmit_form").disabled=!1)},handleCharacterCount=(e,t)=>{const r=id_(e),i=()=>{alertUserCharacters(e,t)};r.addEventListener("keyup",i),r.addEventListener("change",i),r.addEventListener("input",i)};handleCharacterCount("storySummary",400),handleCharacterCount("storyTitle",80),handleCharacterCount("storyText",20602),id_("website").addEventListener("keyup",validateUrl),id_("website").addEventListener("change",validateUrl),id_("backgroundUrl").addEventListener("keyup",validateImgurLink),id_("backgroundUrl").addEventListener("change",validateImgurLink);let isTermsVisible=!1;id_("serviceDate").innerHTML=getCurrentYear();const checkBookTitle=async()=>{let e=id_("storyTitle").value;if(""===e)return;let t=/^[a-zA-Z0-9â€™' -]*$/;if(!t.test(e))return id_("storyTitle").style.color="red",id_("storySubmit_form").disabled=!0,void alert("Only letters and numbers are allowed in the title");id_("storyTitle").style.color="green",id_("storySubmit_form").disabled=!1;let r=`/terrorTales/checkBookTitle/${e}`;const i=id_("csrf").value;try{const e=await fetch(r,{method:"GET",headers:{"csrf-token":i}}),t=await e.json();200===t.status&&(id_("storyTitle").style.color="green",id_("storySubmit_form").disabled=!1),400===t.status&&(id_("storyTitle").style.color="red",id_("storySubmit_form").disabled=!0,alert("Book title already exists"))}catch(e){console.log(e)}};let timer=null;id_("storyTitle").addEventListener("keyup",()=>{clearTimeout(timer),timer=setTimeout(checkBookTitle,1e3)});